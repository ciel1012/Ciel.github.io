---
layout:     post
title:      "Transforms"
subtitle:   "\"《Real-Time Rendering 4th》笔记——第四章 转换\""
date:       2019-05-21
author:     "Ciel"
header-img: "img/post-bg-rtr.jpg"
mathjax: true
tags:
    - Real-Time Rendering
    - 笔记
---

# Transforms

> 本章介绍了转换的基本知识，这是处理几何图形的基本工具。从基本的仿射变换开始，还讨论了矩阵、四元数、顶点混合、变形和投影矩阵。理解这些，有助于辨别如何处理计算，提高代码效率。本章涉及许多线性代数相关内容。

1. [Basic Transforms 基础转换](#基础转换)

2. [Special Matrix Transforms and Operations 特殊矩阵变换和运算](#特殊矩阵变换和运算)

3. [Quaternions 四元数](#四元数)

4. [Vertex Blending 顶点混合](#顶点混合)

5. [Morphing 变形](#变形)

6. [Geometry Cache Playback 几何缓存回放](#几何缓存回放)

7. [Projection 投影](#投影)

### 基础转换

- 线性变换是一种保留向量加法和标量乘法的变换。满足以下公式：

![\img\in-post\rtr4\e1](\img\in-post\rtr4\e1.jpg)

- 使用齐次表示法，方向向量表示为$v = (v_x,v_y,v_z,0)$,点表示为$v = (v_x,v_y,v_z,1)$。

- 所有平移、旋转、缩放、反射和剪切矩阵都是仿射矩阵（affine）。仿射矩阵的主要特征是它保持了直线的并行性，但长度和角度不一定。仿射变换也可以是单个仿射变换的任意序列。

- 正交矩阵的逆就是其转置矩阵。

![\img\in-post\rtr4\t1](\img\in-post\rtr4\t1.jpg)

表4.1，本章讨论的大多数转换的摘要。

#### 4.1.1 Translation 平移

- 从一个位置到另一个位置的变化用一个平移矩阵T表示。这个矩阵用一个向量$t = (t_x, t_y, t_z)$来转换一个实体。

![\img\in-post\rtr4\e2](\img\in-post\rtr4\e2.jpg)

- 如下图，给出了一个平移变换例子。注意，方向向量$v = (v_x,v_y,v_z,0)$不受乘以T的影响，因为方向向量不能被平移。相反，点和向量都受到其余仿射变换的影响。平移矩阵的逆矩阵 $T^1(t)=T(-t)$ ，也就是说向量**t**是负的。

![\img\in-post\rtr4\4-1](\img\in-post\rtr4\4-1.jpg)

原书图4.1，左边的正方形用一个平移矩阵T(5,2,0)进行变换，其中正方形向右移动5个距离单位，向上移动2个距离单位。

- 有时在计算机图形学中看到，使用矩阵中平移向量在底部行，例如DirectX使用这种形式。在这种方案中，应用程序将从左到右读取矩阵。这样的向量和矩阵被称为行主形式，因为这些向量是行向量。在这本书中，使用了列主形式。无论使用哪一种，都是纯粹的符号分歧，当矩阵存储在内存中时，这16个值的后4个值是三个平移值，后面跟着一个1。

#### 4.1.2 Rotation 旋转

- 旋转变换使矢量围绕经过原点的给定轴旋转给定的角度。是一个刚体变换（保留了变换后点的间距，也不会导致左右交换）。方向矩阵是与摄像机视图或对象相关联的旋转矩阵，定义其在空间中的方向，即其向上和向前的方向。

- 二维空间旋转矩阵推导：参数化一个向量$v=(v_x,v_y)=(rcos\theta,rsin\theta)$。如果我们逆时针旋转弧度$\phi$，会得到$u=(rcos(\theta+\phi),rsin(\theta+\phi))$。可以推导出以下公式：

![\img\in-post\rtr4\e3](\img\in-post\rtr4\e3.jpg)

- 三维空间旋转矩阵为以下公式，分别绕x,y,z轴旋转$\phi$：

![\img\in-post\rtr4\e4](\img\in-post\rtr4\e4.jpg)

- 如果从4X4矩阵中删除最下面一行和最右边的列，就得到一个3X3矩阵。对于每一个3X3旋转矩阵R，它围绕任意轴旋转弧度$\phi$，轨迹(矩阵中对角线元素的和)是独立于轴的常数，公式为：

![\img\in-post\rtr4\e5](\img\in-post\rtr4\e5.jpg)

- 所有旋转矩阵的行列式都是1并且是正交的。这也适用于任意数量的这些转换的连接。还可以这样求矩阵倒数:$R_i^{-1}(\phi)=R_i(-\phi)$，即沿同一轴反向旋转。

- 例如图4.2，假设让一个物体绕z轴旋转弧度$\phi$，旋转中心是某个点p。由于绕点旋转的特征是点本身受到旋转影响，所以转换从平移对象开始，使点p与原点重合，通过$T(-p)$完成。之后是实际的旋转：$R_z(\phi)$。最后使用$T(p)$将对象转换回原来的位置。得到的变换X为：

![\img\in-post\rtr4\e6](\img\in-post\rtr4\e6.jpg)

注意上面的旋转顺序

![\img\in-post\rtr4\4-2](\img\in-post\rtr4\4-2.jpg)

#### 4.1.3 Scaling 缩放

- 一个缩放矩阵$S(s)=S(s_x,s_y,s_z)$在x,y,z方向上分别用因子$s_x,s_y,s_z$来缩放对象。任一分量为1则表示不缩放。如果$s_x=s_y=s_z$则是均匀缩放，否则称为非均匀缩放操作。有时用各向同性缩放和各向异性缩放来代替均匀和非均匀。逆矩阵$S^{-1}(s)=S(1/s_x,1/s_y,1/s_z)$。

![\img\in-post\rtr4\e7](\img\in-post\rtr4\e7.jpg)

- 另一种创建均匀缩放矩阵的有效方法是通过使用齐次坐标，操作位置(3,3)处的矩阵元素，即右下角的元素。

### 特殊矩阵变换和运算

### 四元数

### 顶点混合

### 变形

### 几何缓存回放

### 投影
