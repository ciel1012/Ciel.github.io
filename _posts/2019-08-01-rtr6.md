---
layout:     post
title:      "Texturing"
subtitle:   "\"《Real-Time Rendering 4th》笔记——第六章 纹理贴图\""
date:       2019-08-01
author:     "Ciel"
header-img: "img/post-bg-rtr.jpg"
catalog: true
mathjax: true
tags:
    - Real-Time Rendering
---

# Texturing

> 本章详细介绍纹理技术。首先，给出了纹理处理的一般框架。接下来将重点放在使用图像来映射表面，因为这是实时工作中使用的最流行的纹理形式。之后对程序纹理进行了简要的讨论并介绍了几种常用的纹理处理方法。

表面的纹理就是它的外观和触感，想想油画的纹理就知道了。在计算机图形学中，纹理处理是一种使用图像、函数或其他数据源获取一个表面并在每个位置修改其外观的过程。例如，不是精确地表示砖墙的几何形状，而是将砖墙的彩色图像应用于由两个三角形组成的矩形。当矩形被查看时，彩色图像出现在矩形的位置。除非观者靠近墙壁，否则缺乏几何细节将不会被注意到。

然而，一些有纹理的砖墙可能是不令人信服的，不过不是因为缺乏几何形状。例如，如果灰泥是哑光的，而砖是光滑的，那么观察者会注意到两种材料的粗糙度是相同的。为了产生更令人信服的体验，可以在表面应用第二个图像纹理。这种纹理不会改变表面的颜色，而是根据表面的位置改变墙壁的粗糙度。现在砖块和灰泥有了来自图像纹理的颜色和来自这个新纹理的粗糙度值。

观察者可以看到现在所有的砖都是光滑的，而灰泥不是，但请注意，每个砖面似乎是完美的。这看起来不太对，因为砖块的表面通常有些不规则。通过应用凹凸贴图(bump mapping)，砖块的法线可能会发生变化，这样当它们被渲染时，就不会显得非常光滑。为了计算光照，这种纹理会使矩形的原始表面法线方向发生抖动。

从一个浅的视角来看，这种凹凸的错觉可能会被打破。砖块应该突出在灰泥之上，挡住视线。即使从直观的角度看，砖块也应该在灰泥上投下阴影。视差贴图(Parallax mapping)使用纹理在渲染时使表面变形，而视差遮挡贴图(parallax occlusion mapping)将光线投射到高光场纹理上以提高真实感。位移贴图(Displacement  mapping)通过修改形成模型的三角形高度，真正取代了曲面。

![](/img/in-post/rtr6/6-1.jpg)

原书图6.1，纹理。颜色和凹凸贴图被应用到这条鱼，以增加它的视觉细节水平。

### 1纹理管线

纹理是一种有效地建模表面材质和表面粗糙度变化的技术。考虑纹理的一种方法是考虑单个被着色像素的情况。正如在前一章中所看到的，着色是通过考虑材料的颜色和灯光等因素计算出来的。如果存在透明度也会影响样本。纹理是通过修改着色方程中使用的值来实现的。这些值的变化方式通常基于表面的位置。因此，对于砖墙的例子来说，根据表面位置，将表面上任意一点的颜色替换为砖墙图像中相应的颜色。图像纹理中的像素通常称为texels，以便将它们与屏幕上的像素(pixels)区分开来。粗糙度纹理修改了粗糙度值，凹凸纹理改变了法线的方向，所以这些都改变了着色方程的结果。

纹理可以用广义纹理管线来描述。稍后将介绍许多术语并将详细描述管线的每个部分。

空间中的位置是纹理处理的起点。这个位置可以在世界空间中，但更多的时候是在模型的参考框架中，所以当模型移动时，纹理也随之移动。使用Kershaw的术语，空间中的这个点有一个投影(projector)功能，用于获取一组数字，称为纹理坐标(texture mapping)，用于访问纹理。这个过程称为映射(mapping)，因此有了术语纹理映射(texture mapping)。有时纹理图像(texture image)本身被称为纹理映射(texture map)，尽管这并不完全正确。

在使用这些新值访问纹理之前，可以使用一个或多个对应函数将纹理坐标转换为纹理空间。这些纹理空间位置用于从纹理中获取值，例如，它们可以是数组索引到图像纹理中以检索像素。然后，通过值转换函数可能再次转换检索到的值，最后这些新值用于修改表面的某些属性，如材质或着色法线。图6.2详细显示了单个纹理应用程序的这个过程。管线复杂的原因是，每个步骤都为用户提供了一个有用的控件。不过并非所有步骤都需要在任何时候都被激活。

![\img\in-post\rtr6\6-2](\img\in-post\rtr6\6-2.jpg)

原书图6.2，用于单个纹理的通用纹理管线。

使用这个管线，当一个三角形具有砖墙纹理并在其表面生成一个示例时，就会发生这种情况(参见图6.3)。

![\img\in-post\rtr6\6-3](\img\in-post\rtr6\6-3.jpg)

原书图6.3，用于砖墙的管线。

(x,y,z)找到对象的局部坐标系的位置为(-2.3,7.1,88.2)。然后应用投影功能。正如世界地图是三维物体在二维空间中的投影，这里的投影函数通常会改变(x,y,z)向量转化为二元向量(u,v)。本例中使用的投影功能相当于一个正投影(第2.3.1节)，其作用类似于幻灯片投影仪，将砖墙图像投射到三角形表面。要返回到墙面，可以将墙面上的一个点转换成一对值，取值范围从0到1。假设得到的值是(0.32,0.29)。这些纹理坐标将用于确定该位置图像的颜色。砖块纹理的分辨率是256×256，因此对应函数(u,v)乘256，得到(81.92,74.24)。去掉小数，像素(81,74)在砖墙图像中找到，并且色彩值为(0.9,0.8,0.7)。纹理颜色在sRGB颜色空间中，如果要在着色方程中使用颜色，则将其转换为线性空间，得到(0.787,0.604,0.448)(5.6节)。

#### 1.1投影处理

纹理处理的第一步是获取曲面的位置，并将其投影到纹理坐标空间中，通常是二维(u,v)空间。建模通常允许艺术家定义每个顶点的(u,v)坐标。这些可以从投影函数或网格展开算法初始化。艺术家可以用编辑顶点位置同样的方式编辑(u,v)坐标。投影功能通常是通过将空间中的三维点转换为纹理坐标来实现的。建模程序中常用的函数包括球面、圆柱和平面投影。

其他输入可用于投影功能。例如，表面法线可以用来选择六个平面投影方向中的哪一个用于表面。纹理匹配问题发生在面相接的接缝处。Geiss讨论了一种混合它们的技术。Tarini等人描述了多立方体映射(polycube maps)，其中模型映射到一组立方体投影，不同体积的空间映射到不同的立方体。

### 2图像纹理

### 3程序纹理

### 4纹理动画

### 5材质贴图

### 6透明贴图

### 7凹凸贴图

### 8视差贴图

### 9纹理光照
