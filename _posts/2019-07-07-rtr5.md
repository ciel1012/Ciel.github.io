---
layout:     post
title:      "Shading Basics"
subtitle:   "\"《Real-Time Rendering 4th》笔记——第五章 着色基础知识\""
date:       2019-07-07
author:     "Ciel"
header-img: "img/post-bg-rtr.jpg"
catalog: true
mathjax: true
tags:
    - Real-Time Rendering
---

# Shading Basics

> 本章讨论着色基础，同时适用于真实化与风格化渲染。（本书9-14章主要讨论真实感渲染，15章则是风格化渲染）

渲染三维物体的图像时，模型不仅要有合适的几何形状，还要有理想的视觉表现。根据应用程序的不同，可以从真实感到出于创造性原因而选择的各种风格化表现。

![\img\in-post\rtr5\5-1](\img\in-post\rtr5\5-1.jpg)

原书图5.1，上图是使用虚幻引擎渲染的真实景观场景。下图来自Campo Santo的游戏《Firewatch》，该游戏采用了富有特点的艺术风格。

### 1着色模型

确定呈现对象外观的第一步是选择一个着色模型，来描述对象的颜色应该如何根据表面方向、视图方向和光照等因素而变化。

- 例如，使用Gooch着色模型的一个变体。这是非真实感渲染的一种形式，是为了增加技术插图中细节的可读性。Gooch着色背后的基本思想是将表面法线与光的位置进行比较。如果法线指向光，则用较暖的色调给表面上色;如果它指向别处，则使用较冷的色调。两者之间的角度在这些色调之间进行插值，这些色调基于用户提供的表面颜色。在本例中，我们为模型添加了一个风格化的“高亮”效果，以使表面具有闪亮的外观。着色模型通常具有用于控制外观变化的属性。设置这些属性的值是确定对象外观的下一步。示例模型只有一个表面颜色属性，如图5.2的底部图像所示：

![\img\in-post\rtr5\5-2](\img\in-post\rtr5\5-2.jpg)

原书图5.2，一个风格化的着色模型结合Gooch着色和高光效果。上图显示了一个表面颜色为中性的复杂物体。下图显示了不同表面颜色的球体。

- 像大多数着色模型一样，这个例子是由相对于视图和光照方向的表面方向来反映的。为便于着色，这些方向通常表示为标准化(单位长度)向量，如下所示：

![\img\in-post\rtr5\5-3](\img\in-post\rtr5\5-3.jpg)

原书图5.3，示例着色模型的单位长度向量输入:表面法线n、视图向量v和光方向l。

- 确定了着色模型的所有输入，可以查看模型本身的数学定义：

![\img\in-post\rtr5\e1](\img\in-post\rtr5\e1.jpg)

这个方程使用了以下中间计算：

![\img\in-post\rtr5\e2](\img\in-post\rtr5\e2.jpg)

此定义中的一些数学表达式也经常出现在其他着色模型中。clamping操作（通常限制到0或限制在0和1之间）在着色中很常见。这里使用了$x^{\mp}$表示clamping操作，限制s在0-1。点积出现三次，每次出现在两个单位长度向量之间，两个向量的点积是它们的长度和夹角余弦的乘积。因此，两个单位长度向量的点积只是余弦，它比较两个向量彼此对齐程度的有用量度。在着色中，由余弦组成的简单函数通常是描述两个方向(例如光的方向和表面法线)之间关系最简单准确的数学表达式。

- 另一个常用的着色操作是基于0到1之间的标量值在两种颜色之间进行线性插值。该操作的形式为$tc_a+(1-t)c_b$，当t的值分别在1和0之间移动时，在ca和cb之间插值。该式在着色模型中出现两次，第一次是在$c_{warm}$和$c_{cool}$之间进行插值，第二次是在之前的插值结果和$c_{highlight}$之间进行插值。线性插值在着色器中经常出现，它是一个内置函数，称为lerp或mix，在我们所见过的每种着色语言中都是如此。

- $r=2(n\cdot l)n-l$计算出了反射光向量，它将l映射到n上。虽然不像前两个操作那么常见，但对于大多数着色语言来说很常用，可以使用内置的反射(reflect)函数。

- 通过以不同方式将这些操作与各种数学表达式和着色参数组合，可以为各种风格化和逼真的表现定义着色模型。

### 2光源

光照为着色提供了一个主导方向。可以有多个光源，每个光源都有自己的大小、形状、颜色和强度;间接照明增加了更多的变化。我们将在第9章中看到，基于物理的、逼真的光照模型需要考虑所有这些参数。

相反，根据应用程序的需要和视觉风格，风格化的着色模型可以以许多不同的方式使用光照。一些高度程式化的模型可能根本没有灯光的概念，或者(像Gooch着色示例)可能只使用它来提供一些简单的方向性。

光照复杂性的下一步是让着色模型以二分的方式对光的存在或不存在做出反应。用这种着色模型表面在受光和不受光时有不同表现。这意味着区分这两种情况与这些因素有关:与光源的距离、阴影(这将在第7章讨论)、表面是否朝向光源(即表面法线n与光方向l之间的夹角大于90)，或这些因素的某些组合。

这可以表示为一个简单的插值，可能是0到1的有限范围。或者作为一个无界限的量，以另一种方式着色。后者的一个常见选择是将阴影模型分解为光照和非光照部分，光照强度$k_{light}$线性缩放光照部分:

![\img\in-post\rtr5\e3](\img\in-post\rtr5\e3.jpg)

非光照部分funlit(n,v)对应于将光视为二分的着色模型的“不受光影响时的外观”。根据所需的视觉风格和应用程序的需要，它可以有多种形式。例如，funlit() = (0,0,0)将使任何受到光源照射的表面变成纯黑色。另外，非光照部分可以表示某种形式的风格化外观，类似于Gooch模型为背向光的表面使用的冷色。通常，着色模型的这一部分表示某种形式的照明，其不直接来自明确放置的光源，例如来自天空的光或来自周围物体的光。这些其他形式的照明将在第10章和第11章中讨论。

我们之前提到过，光源不影响表面光的方向l大于表面法线n90度的点（实际来自表面下方）。这可以被认为是光相对于表面的方向及其对着色一般影响的一个特例。虽然是基于物理的，但这种关系可以从简单的几何原理推导出来，并且对于许多类型的非基于物理的、风格化的着色模型也是有用的。

![\img\in-post\rtr5\5-4](\img\in-post\rtr5\5-4.jpg)

原书图5.4，上图显示了光在表面上的横截面图。在左边，光线直接照射到表面上；在中间，它们以一个角度照射到表面上；在右边，我们看到使用向量点积来计算角度余弦。下图显示了横切面(包括光和视图向量)与整个表面的关系。

#### 2.1方向光

#### 2.2准时光

#### 2.3其他光源类型

### 3实现光照模型

#### 3.1评估的频率

#### 3.2应用实例

#### 3.3材质系统

### 4锯齿和抗锯齿

#### 4.1抽样滤波理论

#### 4.2基于屏幕的抗锯齿

### 5透明度、Alpha值和合成

#### 5.1混合

#### 5.2顺序无关的透明度

#### 5.3预乘Alpha和合成

### 6显示编码
