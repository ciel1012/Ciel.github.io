---
layout:     post
title:      "Light and Color"
subtitle:   "\"《Real-Time Rendering 4th》笔记——第八章 光与颜色\""
date:       2020-01-11
author:     "Ciel"
header-img: "img/post-bg-rtr.jpg"
catalog: true
mathjax: true
tags:
    - Real-Time Rendering
---

# Light and Color

> 前几章讨论了许多RGB颜色值表示光的强度和颜色。在本章中，我们将学习由这些值测量的各种物理光量，为后面的章节打下基础，这些章节将从更物理的角度讨论渲染。我们还将学习更多关于渲染过程中经常被忽视的“后半部分”：将表示场景线性光量的颜色转换为实际显示颜色。

### 1光量

任何基于物理的渲染方法的第一步都是精确地量化光线。首先介绍了辐射测量学(Radiometry)，因为它是光物理传输的核心领域。我们接着讨论了光度学(photometry)，它处理的是由人眼灵敏度加权的光值。我们对颜色的感知是一种心理物理现象：对物理刺激的心理感知。颜色感知在色度学(colorimetry)一节中讨论。最后，我们讨论了RGB颜色值渲染的有效性。

#### 1.1辐射测量

辐射测量学(Radiometry)研究的是电磁辐射的测量。正如将在9.1节中更详细地讨论的那样，这种辐射以波的形式传播。不同波长的电磁波(具有相同相位的两个相邻点之间的距离，例如两个相邻的峰值)往往具有不同的性质。在自然界中，电磁波的波长范围很广，从长度不到百分之一纳米的伽马波到长达数万公里的极低频(ELF)电波。人类能看到的光波只是这个范围的一小部分，从400纳米的紫光到700多纳米的红光。见图8.1。

![8.1](/img/in-post/rtr8/8-1.jpg)

原书图8.1，显示在整个电磁波谱范围内的可见光波长范围。

辐射量用于测量电磁辐射的各个方面:总体能量、功率(随时间变化的能量)和相对于面积、方向或两者的功率密度。这些数量列于表8.1。

![t8.1](/img/in-post/rtr8/t8-1.jpg)

在辐射测量中，基本单位是辐射通量$\Phi$。辐射通量是辐射能量随时间（功率）的流量，以瓦特（W）为单位。

辐照度是辐射通量相对于面积的密度，即$d\Phi/dA$。辐照度是根据面积来定义的，面积可以是空间中想象的面积，但通常是物体的表面。它的单位是瓦特每平方米。

在讨论下一个量之前，我们需要先介绍立体角的概念，它是角概念的三维扩展。一个角度可以被认为是一个平面上连续的方向集的大小度量，其弧度的值等于这个方向集与半径为1的封闭圆相交的弧的长度。类似地，立体角测量三维空间中连续的方向集合的大小，用半径为1的封闭球体上的相交点的面积来测量(缩写为sr)。立体角由符号表示$\omega$。

在两个维度,一个2π弧度角覆盖整个单位圆。这延伸到三维空间,4π的立体角球面度将覆盖整个地区的单位球。一个立体角的大小可以在图8.2中看到。

![8.2](/img/in-post/rtr8/8-2.jpg)

原书图8.2，从球体的剖视图中删除的立体角为一个球面度的圆锥体。形状本身与测量无关。 球体表面的覆盖范围是关键。

现在我们可以引入辐射强度I，它是相对于方向的通量密度，更确切地说是立体角($d\Phi/d\omega$)。单位为瓦/每球面度。

最后，辐射强度L是单一射线中电磁辐射的量度。更准确地说，它被定义为辐射通量密度相对于面积和立体角($d^2\Phi/dAd\omega$)。这个面积是在垂直于射线的平面上测量的。如果辐射是应用到一个表面在其他方向，那么余弦校正因子必须使用。参考该校正系数，可能会遇到使用“投影面积”这一术语的辐射定义。

辐射率是传感器(如眼睛或照相机)测量的值(详细信息请参阅9.2节)，所以它对于渲染来说是最重要的。计算着色方程的目的是计算从着色面点到摄像机的沿给定光线的亮度。沿着这条射线的L值是第5章中基于物理的量$C_{shaded}$的等价物。辐射的公制单位是瓦特每平方米每球面度。

环境中的辐射可以看作是五个变量(或六个，包括波长)的函数，称为辐射分布。其中三个变量指定位置，另外两个指定方向。这个函数描述了所有的光在空间中移动。一种理解渲染过程的方法是，眼睛和屏幕定义一个点和一组方向(例如，一条射线通过每个像素)，然后在眼睛处对每个方向进行评估。第13.4节讨论的基于图像的渲染使用了一个相关的概念，称为光场light field。

在着色方程中，辐度通常表示为$L_o(x,d)$或$L_i(x,d)$，分别表示从x点发出或进入x点的辐射。方向向量d表示射线的方向，根据惯例，它总是指向远离x的方向。虽然在Li的情况下，这个约定可能有点令人困惑，因为d指向与光传播相反的方向，但是对于点积之类的计算是方便的。

辐射的一个重要特性是它不受距离的影响，忽略了大气的影响，如雾。换句话说，不管与观察者的距离有多远，一个表面都会有相同的亮度。距离越远，表面覆盖的像素越少，但每个像素处的表面辐射是恒定的。

大多数光波是包含多种不同波长的混合物。这通常被可视化为光谱功率分布(spectral power distribution SPD)，这是一个显示光的能量如何分布在不同波长的图。图8.3显示了三个示例。值得注意的是，尽管在图8.3中，中间和底部的SPD差异很大，但是它们被认为是相同的颜色。很明显，人类的眼睛不适合使用光谱仪。我们将在8.1.3节中详细讨论颜色视觉。

![8.3](/img/in-post/rtr8/8-3.jpg)

原书图8.3，三种不同光波的光谱功率分布。顶部的SPD是一种绿色激光，其光谱分布非常窄。其波形类似于图9.1中的简单正弦波。中间的SPD用于由相同的绿色激光加上两个额外的激光组成的光，一个红色和一个蓝色。这些激光的波长和相对强度与显示中性白色的RGB激光投影显示器相对应。底部的SPD是标准的D65光源，这是一个典型的中性白色参考，用来代表户外照明。这样的SPD是典型的自然光，它的能量不断地散布在可见光谱上。

所有辐射量都有光谱分布。由于这些分布是密度在波长上的分布，它们的单位是原始量除以纳米。例如，辐照度的光谱分布的单位是瓦特每平方米每纳米。

由于完整的SPD很难用于渲染，特别是在交互速率下，因此在实践中辐射量被表示为RGB三元组。在8.1.3节中，我们将解释这些三元组与光谱分布的关系。

#### 1.2光度学

辐射测量学只研究物理量，不考虑人的感知。一个相关的领域，光度学(photometry)，就像辐射测量学，只是它是通过人眼的敏感度来衡量一切的。辐射计算的结果通过乘以CIE光度曲线转换为光度单位，CIE光度曲线是一条以555 nm为中心的钟形曲线，表示眼睛对各种波长的光的反应。参见图8.4。

![8.4](/img/in-post/rtr8/8-4.jpg)

原书图8.4，光度曲线。

转换曲线和测量单位是光度学理论和辐射测量理论的唯一区别。每个辐射量都有一个等效的米制光度量。表8.2显示了每一个的名称和单位。单位都有预期的关系(例如，勒克斯lux是光通量lumen每平方米)。虽然在逻辑上lumen应该是基本单位，但在历史上坎德拉candela被定义为一个基本单位，其他单位是从它派生出来的。在北美，照明设计师使用废弃的英制计量单位英尺烛光(foot-candle fc)来测量照度，而不是照度lux。无论哪种情况，illuminance都是大多数照度计所测量的，在照明工程中是很重要的。

![t8.2](/img/in-post/rtr8/t8-2.jpg)

原书表8.2，辐射和光度的数量和单位。

luminance通常用来描述物体表面的亮度。例如，高动态范围(HDR)电视屏幕的峰值亮度通常在500到1000 nits之间。相比之下，晴空的亮度约为8000nit，一个60瓦灯泡的亮度约为12万nit，太阳在地平线处的亮度约为60万nit。

#### 1.3色度学

在第8.1.1节中，我们已经看到，我们对光的颜色的感知与光的SPD(光谱功率分布)紧密相连。而且这不是简单的一对一对应。图8.3中的底部和中间SPD完全不同，但被认为是完全相同的颜色。色度学Colorimetry研究光谱功率分布与颜色感知之间的关系。

人类可以分辨大约1000万种不同的颜色。对于颜色感知，眼睛的工作原理是视网膜上有三种不同类型的锥体感受器，每种类型的感受器对不同的波长有不同的反应。其他动物有不同数量的颜色感受器，有时多达15个。因此，对于一个给定的SPD，我们的大脑只从这些受体接收到三种不同的信号。这就是为什么只用三个数字可以精确地表示任何颜色刺激。

但是哪三个数字呢?CIE (Commission Internationale d'Eclairage)提出了一套测量颜色的标准条件，并使用它们进行了颜色匹配实验。在颜色匹配中，将三种彩色的光投射在白色屏幕上，以便它们的颜色加在一起并形成色块。匹配的测试颜色投射在此色块旁边。测试色块是单一波长的。然后观察者可以使用校准到加权范围[-1,1]的旋钮来改变三种颜色的光，直到测试颜色匹配为止。需要负权值来匹配一些测试颜色，这样的权值意味着将相应的光添加到波长的测试色块中。图8.5中显示了三种灯(r、g和b)的一组测试结果。这些光几乎是单色的，每个光的能量分布都集中在以下波长之一附近：r的波长为645 nm，g的波长为526 nm，b的波长为444 nm。将每组匹配权重与测试色块波长相关联的函数称为颜色匹配函数color-matching functions。

![8.5](/img/in-post/rtr8/8-5.jpg)

原书图8.5，r、g、b二度色彩搭配曲线，来自Stiles和Burch。这些配色曲线不能与用于配色实验的光源的光谱分布相混淆，因为光源是纯波长的。

这些函数给出了一种将光谱功率分布转换为三个值的方法。在给定单一波长的光的情况下，可以从图形，旋钮设置和创建的照明条件中读取三种彩色的照明设置，这些设置将使屏幕上的两个照明块都具有相同的感觉。对于任意的光谱分布，颜色匹配函数可以乘以每个结果曲线下的分布和面积(即，积分)给出相对的数量，设置彩色的光，以匹配感知到的颜色产生的光谱。相当不同的光谱分布可以解析为相同的三个权重，即，对于观察者而言，它们看起来相同。提供匹配权重的光谱分布称为元模型metamers。

三种加权的r、g、b光不能直接代表所有可见的颜色，因为它们的配色函数对不同的波长都有负的权值。CIE提出了三种不同的假设光源，它们的颜色匹配函数对所有可见波长都是正的。这些曲线是原始的r、g和b颜色匹配函数的线性组合。这就要求光源的光谱功率分布在某些波长为负，因此这些光是不可实现的数学抽象。它们的颜色匹配函数分别为$\overline{x}(\lambda),\overline{y}(\lambda),\overline{z}(\lambda)$，如图8.6所示。配色函数$\overline{y}(\lambda)$与光度曲线相同(图8.4)，用该曲线将radiance转换为luminance。

![8.6](/img/in-post/rtr8/8-6.jpg)

原书图8.6，Judd-Vos-modified CIE(1978) 2度配色函数。注意，这两个$\overline{x}$是同一条曲线的一部分。

与前一套颜色匹配函数相同，$\overline{x}(\lambda),\overline{y}(\lambda),\overline{z}(\lambda)$是通过乘法和积分用来减少任何SPD $s(\lambda)$的三个数字：

![e8.1](/img/in-post/rtr8/e8.1.jpg)

这些X、Y和Z三刺激值是在CIE XYZ空间中定义颜色的权重。把颜色分成亮度luminance(brightness)和色度chromaticity通常是很方便的。色度是指颜色与亮度无关的特性。例如，两种深浅不同的蓝色，一种暗的，一种亮的，可以有相同的色度，尽管在亮度上不同。

为此，CIE通过将颜色投射到X + Y + Z = 1平面上来定义二维色度空间。参见图8.7。这个空间中的坐标称为x和y，计算如下:

![e8.2](/img/in-post/rtr8/e8.2.jpg)

![8.7](/img/in-post/rtr8/8-7.jpg)

原书图8.7，CIE RGB三原色的RGB颜色立方体显示在XYZ空间中，以及它在X + Y + Z = 1平面上的投影(紫色)。蓝色轮廓覆盖可能的色度值空间。从原点辐射出来的每条线都有一个恒定的色度值，只是亮度不同。

